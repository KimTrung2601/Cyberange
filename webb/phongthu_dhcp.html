<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√≤ng th·ªß DHCP ‚Äì Gi·∫£i ph√°p DHCP Snooping</title>

    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* GI·ªÆ NGUY√äN CSS C·ª¶A B·∫†N */
        :root {
            --bg-dark: #0f1624;
            --bg-card: #1a2332;
            --blue: #3fa9f5;
            --text: #e6eef7;
            --muted: #98a6b8;
            --orange: #f5b041;
            --red: #e74c3c;
            --border-light: #2c3a4d;
        }

        body {
            background: var(--bg-dark);
            margin: 0;
            font-family: "Segoe UI", sans-serif;
        }

        .app { display: flex; min-height: 100vh; }

        .sidebar {
            min-width: 280px;
            background: #131b29;
            border-right: 1px solid #243044;
            padding: 24px;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 10px 14px;
            display: block;
            border-radius: 6px;
            color: var(--muted);
            text-decoration: none;
            transition: 0.2s;
        }
        .nav-item:hover { background: #1f2a3b; color: white; }

        .main { flex-grow: 1; }

        .main-topbar {
            background: #10141a;
            padding: 15px 30px;
            border-bottom: 1px solid var(--border-light);
        }

        .guide-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 25px;
            color: var(--text);
        }

        h2 {
            margin-top: 35px;
            font-size: 24px;
            color: var(--blue);
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 8px;
        }

        h3 {
            margin-top: 20px;
            font-size: 19px;
            color: var(--text);
            font-weight: 700;
        }

        p, ul {
            font-size: 16px;
            line-height: 1.7;
            color: var(--muted);
        }
        ul { padding-left: 22px; }

        .guide-image-container {
            border: 1px solid var(--border-light);
            border-radius: 10px;
            margin: 25px 0;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.4);
        }
        .guide-image-container img { width:100%; display:block; }
        .image-caption {
            padding: 10px;
            background: #1e2a3b;
            color: #cfe1ff;
            font-style: italic;
            font-size: 14px;
        }

        .code-block {
            background:#131c27;
            border-left:5px solid var(--orange);
            padding:18px 20px;
            border-radius:10px;
            margin:25px 0;
            box-shadow:0 0 12px rgba(0,0,0,0.6);
            font-family:Consolas, monospace;
            color:#f6d76c;
            font-size:15px;
            white-space:pre-wrap;
        }

        .log-block {
            background:#1a2332;
            border-left:5px solid var(--red);
            padding:18px 20px;
            border-radius:10px;
            margin:25px 0;
            box-shadow:0 0 12px rgba(231,76,60,0.4);
            font-family:Consolas, monospace;
            color:#ffb3b3;
            font-size:15px;
            white-space:pre-wrap;
        }

        /* Quiz */
        .quiz-container {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            margin-top: 40px;
            border: 1px solid var(--border-light);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .quiz-input {
            flex-grow: 1;
            padding: 10px;
            background: #0f1624;
            border: 1px solid var(--border-light);
            color: var(--text);
            border-radius: 6px;
        }

        .quiz-button {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
    </style>
</head>

<body>

<div class="app">

    <aside class="sidebar">
        <header class="sidebar-logo">
            <i class="fas fa-shield-alt"></i>
            <span>CYBER<br>RANGES</span>
        </header>

        <div class="sidebar-user">
            <strong id="sidebar-username">My Account</strong>
            <small>My Account</small>
        </div>

        <nav class="sidebar-nav">
            <a href="#" onclick="history.back(); return false;" class="nav-item active">
                <i class="fas fa-arrow-left"></i> Back to Playlists
            </a>


            <h3 style="color:white; margin-top:20px;">M·ª•c l·ª•c</h3>
            <a class="nav-item" href="#tong-quan">1. M·ª•c ti√™u & M√¥ h√¨nh</a>
            <a class="nav-item" href="#cau-hinh">2. C·∫•u h√¨nh DHCP Snooping</a>
            <a class="nav-item" href="#kiem-tra">3. K·∫øt qu·∫£ & ƒê√°nh gi√°</a>
            <a class="nav-item" href="#quiz">4. Quiz</a>
        </nav>
    </aside>

    <main class="main">

        <header class="main-topbar">
            <h1 style="color:white; margin:0;font-size:26px;">
                <i class="fas fa-shield-alt" style="color:var(--blue); margin-right:10px;"></i>
                Ph√≤ng th·ªß DHCP ‚Äì Gi·∫£i ph√°p DHCP Snooping
            </h1>
        </header>

        <section class="guide-container">


            <h2 id="tong-quan">üìå 1. M·ª•c ti√™u v√† M√¥ h√¨nh th·ª±c nghi·ªám</h2>
                <div class="video-embed" style="margin-bottom:35px; position:relative; padding-bottom:56.25%; height:0;">
    <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;border:none;"
            src="https://www.youtube.com/embed/K6MKrEn5uGc?si=bSPaQ197tIDVasem"
            allowfullscreen></iframe>
</div>
            <p>
                Gi·∫£i ph√°p ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n n·ªÅn t·∫£ng gi·∫£ l·∫≠p **GNS3** t√≠ch h·ª£p v·ªõi m√°y ·∫£o **VMware** ƒë·ªÉ kh·∫Øc ph·ª•c h·∫°n ch·∫ø b·∫£o m·∫≠t tr√™n Switch ·∫£o.
            </p>

            <p>
                **DHCP Snooping** ph√¢n lo·∫°i c·ªïng m·∫°ng th√†nh hai nh√≥m:
            </p>

            <ul>
                <li><strong>C·ªïng Tin c·∫≠y (Trusted):</strong> Ch·ªâ cho ph√©p g√≥i DHCP ph·∫£n h·ªìi (**OFFER, ACK**) t·ª´ Server h·ª£p l·ªá ƒëi qua.</li>
                <li><strong>C·ªïng Kh√¥ng tin c·∫≠y (Untrusted):</strong> Ch·∫∑n g√≥i DHCP ph·∫£n h·ªìi t·ª´ ngu·ªìn kh√¥ng x√°c ƒë·ªãnh v√† gi·ªõi h·∫°n t·ªëc ƒë·ªô g√≥i tin ƒë·ªÉ ngƒÉn ch·∫∑n t·∫•n c√¥ng l√†m c·∫°n ki·ªát (**Starvation**).</li>
            </ul>

            <h3>M√¥ h√¨nh th·ª±c nghi·ªám:</h3>
            <ul>
                <li><strong>Switch trung t√¢m (Cisco IOSvL2):</strong> Thi·∫øt b·ªã chuy·ªÉn m·∫°ch l·ªõp 2 c√≥ kh·∫£ nƒÉng qu·∫£n l√Ω.</li>
                <li><strong>Windows Server 2019:</strong> DHCP Server h·ª£p l·ªá (Trusted Server).</li>
                <li><strong>Kali Linux:</strong> K·∫ª t·∫•n c√¥ng (Rogue Server).</li>
                <li><strong>Windows 10:</strong> N·∫°n nh√¢n (DHCP Client).</li>
            </ul>
            
            <div class="guide-image-container">
                <img src="images/hinh98.jpg">
                <div class="image-caption">H√¨nh 4. 18. M√¥ h√¨nh m·∫°ng GNS3</div>
            </div>

            <h2 id="cau-hinh">‚öôÔ∏è 2. C·∫•u h√¨nh tr√™n Switch Cisco (GNS3)</h2>

            <p>C·∫•u h√¨nh ƒë∆∞·ª£c th·ª±c hi·ªán tr·ª±c ti·∫øp tr√™n giao di·ªán d√≤ng l·ªánh (CLI) c·ªßa Switch Cisco.</p>
            
            <h3>B∆∞·ªõc 1: V√†o ch·∫ø ƒë·ªô c·∫•u h√¨nh</h3>
            <div class="code-block">
enable
configure terminal
            </div>

            <h3>B∆∞·ªõc 2: B·∫≠t t√≠nh nƒÉng DHCP Snooping</h3>
            <p>K√≠ch ho·∫°t t√≠nh nƒÉng DHCP Snooping tr√™n VLAN 1 v√† t·∫Øt Option 82.</p>
            <div class="code-block">
ip dhcp snooping
ip dhcp snooping vlan 1
T·∫Øt t√≠nh nƒÉng ch√®n option 82 n·∫øu DHCP Server kh√¥ng h·ªó tr·ª£
no ip dhcp snooping information option
            </div>
            <div class="guide-image-container">
                <img src="images/hinh99.jpg">
                <div class="image-caption">H√¨nh B·∫≠t t√≠nh nƒÉng DHCP Snooping.</div>
            </div>

            <h3>B∆∞·ªõc 3: C·∫•u h√¨nh c·ªïng tin c·∫≠y (Trusted) - GigabitEthernet0/0</h3>
            <p>ƒê√¢y l√† b∆∞·ªõc quan tr·ªçng nh·∫•t ƒë·ªÉ server th·∫≠t c√≥ th·ªÉ c·∫•p IP.</p>
            <div class="code-block">
interface GigabitEthernet0/0
ƒê·∫∑t m√¥ t·∫£: 
description NOI_VOI_WINSERVER
ip dhcp snooping trust
Exit
            </div>
            <div class="guide-image-container">
                <img src="images/hinh100.jpg">
                <div class="image-caption">H√¨nh c·∫•u h√¨nh c·ªïng tin c·∫≠y.</div>
            </div>
            
            <h3>B∆∞·ªõc 4: C·∫•u h√¨nh c·ªïng kh√¥ng tin c·∫≠y (Untrusted) - GigabitEthernet0/1, 0/2</h3>
            <p>Gi·ªõi h·∫°n t·ªëc ƒë·ªô: ch·ªâ cho ph√©p t·ªëi ƒëa **10 g√≥i DHCP m·ªói gi√¢y**, n·∫øu Kali spam qu√° nhanh, c·ªïng n√†y s·∫Ω t·ª± ƒë·ªông b·ªã kh√≥a.</p>
            <div class="code-block">
interface range GigabitEthernet0/1 , GigabitEthernet0/2
description CONG_UNTUDO
no ip dhcp snooping trust
ip dhcp snooping limit rate 10
End
            </div>
            <div class="guide-image-container">
                <img src="images/hinh101.jpg">
                <div class="image-caption">H√¨nh c·∫•u h√¨nh c·ªïng kh√¥ng tin c·∫≠y.</div>
            </div>

            <h3>B∆∞·ªõc 5: L∆∞u c·∫•u h√¨nh v√† ki·ªÉm tra</h3>
            <div class="code-block">
Write memory
Show ip dhcp snooping
            </div>
            
            <div class="guide-image-container">
                <img src="images/hinh102.jpg">
                <div class="image-caption">H√¨nh 4. 19. L∆∞u c·∫•u h√¨nh v√† ki·ªÉm tra</div>
            </div>
            <div class="guide-image-container">
                <img src="images/hinh103.jpg">
                <div class="image-caption">H√¨nh 4. 20. show ip switch</div>
            </div>


            <h2 id="kiem-tra">üîç 3. K·∫øt qu·∫£ th·ª±c nghi·ªám v√† ƒê√°nh gi√°</h2>

            <p>
                Sau khi √°p d·ª•ng c·∫•u h√¨nh, th·ª±c hi·ªán l·∫°i k·ªãch b·∫£n t·∫•n c√¥ng ƒë·ªÉ ki·ªÉm ch·ª©ng hi·ªáu qu·∫£.
            </p>

            <h3>K·∫øt qu·∫£ tr√™n Switch:</h3>
            
            <p>
                H·ªá th·ªëng ngƒÉn ch·∫∑n th√†nh c√¥ng c√°c g√≥i tin DHCP gi·∫£ m·∫°o. L·ªánh `show ip dhcp snooping statistics` cho th·∫•y s·ªë l∆∞·ª£ng g√≥i b·ªã lo·∫°i b·ªè (**Packets Dropped**) tƒÉng l√™n.
            </p>
            
            <p>
                Khi v∆∞·ª£t qu√° ng∆∞·ª°ng gi·ªõi h·∫°n, Switch t·ª± ƒë·ªông ƒë∆∞a c·ªïng k·∫ª t·∫•n c√¥ng v√†o tr·∫°ng th√°i l·ªói (**Err-Disable**) ƒë·ªÉ c√¥ l·∫≠p.
            </p>

            <div class="guide-image-container">
                <img src="images/hinh104.jpg">
                <div class="image-caption">H√¨nh 4. 21. H·ªá th·ªëng ghi nh·∫≠n v√† ngƒÉn ch·∫∑n th√†nh c√¥ng c√°c g√≥i tin DHCP gi·∫£ m·∫°o</div>
            </div>

            <h3>K·∫øt qu·∫£ tr√™n m√°y N·∫°n nh√¢n (Windows 10):</h3>
            
            <p>
                M√°y n·∫°n nh√¢n ch·ªâ nh·∫≠n ƒë∆∞·ª£c ƒë·ªãa ch·ªâ IP t·ª´ m√°y ch·ªß h·ª£p l·ªá (Windows Server 2019). C√°c g√≥i tin gi·∫£ m·∫°o t·ª´ Rogue Server ƒë√£ b·ªã Switch lo·∫°i b·ªè ho√†n to√†n.
            </p>

            <p class="intro-section highlight" style="
                background: #1a2332;
                border: 1px solid #3fa9f5;
                padding: 15px;
                border-radius: 8px;
                margin-top: 30px;
                color: var(--text);
            ">
                ‚úÖ **ƒê√°nh gi√°:** Gi·∫£i ph√°p DHCP Snooping ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai th√†nh c√¥ng, ngƒÉn ch·∫∑n tri·ªát ƒë·ªÉ **DHCP Starvation** v√† **Rogue DHCP Server**, ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªãch v·ª• c·∫•p ph√°t IP.
            </p>


            <h2 id="quiz">üìù 4. Quiz ki·ªÉm tra ki·∫øn th·ª©c</h2>

            <div class="quiz-container" style="
                background: var(--bg-card);
                padding: 30px;
                border-radius: 12px;
                margin-top: 25px;
                border: 1px solid var(--border-light);
                box-shadow: 0 0 12px rgba(63,169,245,0.25);
            " id="quiz-anchor">

                <div id="completion-message" style="
                    display:none;
                    padding:20px;
                    background:#27ae60;
                    color:white;
                    border-radius:8px;
                    text-align:center;
                    font-size:18px;
                    font-weight:700;
                    box-shadow:0 0 10px rgba(0,0,0,0.3);
                ">
                    <i class="fas fa-check-circle"></i> CH√öC M·ª™NG! B·∫†N ƒê√É HO√ÄN TH√ÄNH B√ÄI LAB PH√íNG TH·ª¶!
                </div>

                <div id="question-1" class="question-block">
                    <h3>1. Khi k√≠ch ho·∫°t DHCP Snooping, lo·∫°i c·ªïng n√†o ch·ªâ cho ph√©p g√≥i DHCP OFFER/ACK ƒëi qua?</h3>
                    <p>Nh·∫≠p t√™n lo·∫°i c·ªïng (ti·∫øng Vi·ªát ho·∫∑c ti·∫øng Anh).</p>

                    <div class="input-group">
                        <input type="text" id="answer-1" class="quiz-input" placeholder="Nh·∫≠p t√™n lo·∫°i c·ªïng..." />
                        <button class="quiz-button" onclick="checkAnswer(1)">Check</button>
                    </div>

                    <p id="feedback-1" class="quiz-feedback"></p>
                </div>

                <div id="question-2" class="question-block" style="display:none;">
                    <h3>2. L·ªánh n√†o ƒë∆∞·ª£c d√πng ƒë·ªÉ gi·ªõi h·∫°n s·ªë l∆∞·ª£ng g√≥i DHCP tr√™n c·ªïng kh√¥ng tin c·∫≠y?</h3>
                    <p>Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß ho·∫∑c m·ªôt ph·∫ßn quan tr·ªçng c·ªßa l·ªánh.</p>

                    <div class="input-group">
                        <input type="text" id="answer-2" class="quiz-input" placeholder="Nh·∫≠p t√™n l·ªánh..." />
                        <button class="quiz-button" onclick="checkAnswer(2)">Check</button>
                    </div>

                    <p id="feedback-2" class="quiz-feedback"></p>
                </div>

                <div id="question-3" class="question-block" style="display:none;">
                    <h3>3. Ch·ª©c nƒÉng gi·ªõi h·∫°n t·ªëc ƒë·ªô g√≥i DHCP gi√∫p ngƒÉn ch·∫∑n h√¨nh th·ª©c t·∫•n c√¥ng n√†o?</h3>
                    <p>Tr·∫£ l·ªùi b·∫±ng t√™n ƒë·∫ßy ƒë·ªß ho·∫∑c vi·∫øt t·∫Øt.</p>

                    <div class="input-group">
                        <input type="text" id="answer-3" class="quiz-input" placeholder="Nh·∫≠p t√™n t·∫•n c√¥ng..." />
                        <button class="quiz-button" onclick="checkAnswer(3)">Check</button>
                    </div>

                    <p id="feedback-3" class="quiz-feedback"></p>
                </div>

                <div id="question-4" class="question-block" style="display:none;">
                    <h3>4. T√™n g·ªçi cho m√°y ch·ªß DHCP b·∫•t h·ª£p ph√°p trong m·∫°ng l√† g√¨?</h3>

                    <div class="input-group">
                        <input type="text" id="answer-4" class="quiz-input" placeholder="Nh·∫≠p t√™n g·ªçi (ti·∫øng Anh)..." />
                        <button class="quiz-button" onclick="checkAnswer(4)">Check</button>
                    </div>

                    <p id="feedback-4" class="quiz-feedback"></p>
                </div>

                <div id="question-5" class="question-block" style="display:none;">
                    <h3>5. Khi s·ªë l∆∞·ª£ng g√≥i DHCP tr√™n c·ªïng kh√¥ng tin c·∫≠y v∆∞·ª£t qu√° ng∆∞·ª°ng, Switch s·∫Ω ƒë∆∞a c·ªïng ƒë√≥ v√†o tr·∫°ng th√°i n√†o?</h3>

                    <div class="input-group">
                        <input type="text" id="answer-5" class="quiz-input" placeholder="Nh·∫≠p tr·∫°ng th√°i (ti·∫øng Anh)..." />
                        <button class="quiz-button" onclick="checkAnswer(5)">Check</button>
                    </div>

                    <p id="feedback-5" class="quiz-feedback"></p>
                </div>

            </div>


            <div style="margin-top:60px; border-top:1px solid var(--border-light); padding-top:20px; text-align:center; color:var(--muted);">
                ¬© 2025 Cyber Ranges Platform
            </div>


            <script>
                // 1. C·∫§U H√åNH ƒê√ÅP √ÅN (c√≥ th·ªÉ ƒë·ªïi n·ªôi dung cho ph√π h·ª£p lab DHCP)
                const correctAnswers = {
                    1: ["..."],
                    2: ["..."],
                    3: ["..."],
                    4: ["..."],
                    5: ["..."]
                };
            
                // --- H√ÄM G·ª¨I TI·∫æN ƒê·ªò (NH·∫¨N S·ªê PH·∫¶N TRƒÇM) ---
                async function submitProgress(percent) {
                    const username = localStorage.getItem("cyber_current_user");
                    
                    if (!username) {
                        console.log("Ch∆∞a ƒëƒÉng nh·∫≠p, kh√¥ng l∆∞u ƒë∆∞·ª£c.");
                        return;
                    }
            
                    try {
                        console.log(`ƒêang g·ª≠i ti·∫øn ƒë·ªô ${percent}% v·ªÅ Server...`);
                        
                        // üëá CH·ªà ƒê·ªîI labId ·ªû ƒê√ÇY
                        const response = await fetch('/api/submit-quiz', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                username: username, 
                                labId: 'phongthu_arp',   // <-- t√™n lab DHCP
                                progress: percent 
                            })
                        });
            
                        const data = await response.json();
                        console.log("Server ƒë√£ l∆∞u:", data);
            
                    } catch (error) {
                        console.error("L·ªói k·∫øt n·ªëi Server:", error);
                    }
                }
            
                // 2. H√ÄM CHU·∫®N H√ìA ƒê√ÅP √ÅN
                function normalizeAnswer(answer) {
                    return answer.toLowerCase().trim()
                        .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"")
                        .replace(/\s{2,}/g," ");
                }
            
                // 3. H√ÄM CHECK ƒê√ÅP √ÅN
                function checkAnswer(questionNumber) {
                    const inputId = 'answer-' + questionNumber;
                    const feedbackId = 'feedback-' + questionNumber;
                    const currentQuestionId = 'question-' + questionNumber;
                    
                    const userInput = document.getElementById(inputId).value;
                    const feedbackElement = document.getElementById(feedbackId);
                    const currentQuestionElement = document.getElementById(currentQuestionId);
                    
                    const normalizedInput = normalizeAnswer(userInput);
                    const validAnswers = correctAnswers[questionNumber];
                    let isCorrect = false;
            
                    for (const valid of validAnswers) {
                        if (normalizedInput.includes(normalizeAnswer(valid))) {
                            isCorrect = true;
                            break;
                        }
                    }
            
                    if (isCorrect) {
                        feedbackElement.style.color = '#2ecc71';
                        feedbackElement.innerHTML = '<i class="fas fa-check"></i> Ch√≠nh x√°c!';
                        
                        document.getElementById(inputId).disabled = true;
                        currentQuestionElement.querySelector('.quiz-button').disabled = true;
            
                        const currentPercent = questionNumber * 20;
                        submitProgress(currentPercent); 
            
                        setTimeout(() => {
                            currentQuestionElement.style.display = 'none';
            
                            if (questionNumber < 5) {
                                const nextQuestionId = 'question-' + (questionNumber + 1);
                                const nextQuestionElement = document.getElementById(nextQuestionId);
                                if (nextQuestionElement) {
                                    nextQuestionElement.style.display = 'block';
                                    document.getElementById('feedback-' + (questionNumber + 1)).innerHTML = '';
                                }
                            } else {
                                document.getElementById('completion-message').style.display = 'block';
                                document.getElementById('quiz').scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        }, 500);
            
                    } else {
                        feedbackElement.style.color = '#e74c3c';
                        feedbackElement.innerHTML = '<i class="fas fa-times"></i> Ch∆∞a ch√≠nh x√°c. Vui l√≤ng th·ª≠ l·∫°i!';
                    }
                }
            
                // 4. KH·ªûI T·∫†O
                document.addEventListener('DOMContentLoaded', () => {
                    const allQuestions = document.querySelectorAll('.question-block');
                    allQuestions.forEach(q => { q.style.display = 'none'; });
                    const firstQuestion = document.getElementById('question-1');
                    if (firstQuestion) { firstQuestion.style.display = 'block'; }
                });
            </script>
            
            